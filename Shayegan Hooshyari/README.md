---
rtl: true
---
Pycon presentation available at [[Pycon Presentation]]

## چگونه مطمئن شویم کد کار میکند؟
### شایگان هوشیاری
---
![[Pasted image 20220212163244.png|400 ]]
- توسعه‌ی پلتفرم‌های آنالیز داده بر بستر AWS
- ساده سازی ذخیره سازی و استفاده از داده برای کلاینت‌ها



---

![[DC-vision.png|500]]

---
## موضوع
- فلسفه‌ی تست نوشتن
- توسعه‌ی تست محور یا TDD
- چطور تست بنویسیم؟
- تست نوشتن در پایتون
- نکات پایانی

---

## فلسفه‌ی تست نوشتن
- اگر تست‌ها پاس بشه کد خطای قابل توجهی نداره
- اگر تغییری باعث ایجاد باگ در سیستم شده اون رو بفهمیم
- تعداد باگ‌های نرم افزار رو کمتر کنیم 
- از باگ‌هایی تابحال داشتیم برای نوشتن تست ایده بگیریم

---
### ایده‌ی توسعه‌ی تست محور
- یک راه برای توسعه‌ی کد تست شده ارائه شده در ۱۹۹۰
- اول به تست فکر کنیم

![[TDD-benfits-meme.png|500]]

---

### پیاده سازی با TDD
- کدی بنویسیم که خروجی کدی که میخواهیم بنویسم رو بررسی کنه
- کد اصلی رو بنویسیم و تا جایی که تست پاس شود
- کد‌های جدید و قبلی رو refactor کنیم تا به چیزی که میخواهیم نزدیک تر شود
![[TDD-flow-chart.png]]

---
### فایده‌ی TDD
- همیشه کدی که می‌نویسیم تست شده است
- کمک می‌کند به هدف اصلی کدی که میخواهیم بنویسیم فکر کنیم و جزئیات پیاده سازی رو کنار بذاریم

---

## چطور تست بنویسیم؟
- از کوچکترین بخش کد شروع کنیم
- رفتار‌های مختلف کد رو تست کنیم.
	- آیا کد با ورودی صحیح خروجی صحیح تولید می‌کند؟
	- آیا کد با ورودی غلط خروجی مناسبی برمی‌گرداند؟
![[test-pyramid.png]]

---

### چه چیزی رو تست کنیم؟
- رفتار و خروجی سیستم:
	- مثال درست: اگر ورودی x را به سیستم بدهیم آیا خروجی y است؟
	- مثال نادرست: اگر ورودی x را به سیستم بدهیم آیا تابع z خروجی y را می‌دهد؟
- تست‌هایی که خیلی به پیاده سازی نزدیک هستند سریع‌ منقضی می‌شوند
- نیاز نیست ۱۰۰ درصد کد تست شده باشد
- بخش‌های تست پذیر رو از بخش‌هایی که تست کردن آن سخت است جدا کنیم

---
### پترن Humble Object
![[humble-object-pattern.png]]

---

## تست نوشتن در پایتون
- unit test
- pytest
![[pytest-logo.png|100]]

---

### یک مثال از Pytest
![[pytest-example.png]] 

---

### قدم به قدم نوشتن تست
- فرض کنیم میخواهیم ابزاری بنویسیم که HTTP query string را parse کند
![[HTTP-url-parts.png]]

---

### مرحله ۱: به کدی که میخواهیم فکر کنیم
- ما کلاسی داریم که میخواهیم یک string در ورودی بگیرد و به کاربر مقادیر query string را بازگرداند
- داشتن تابعی مانند get_parameter به ما در پنهان کردن جزئیات پیاده سازی کمک میکند

---

### مرحله ۲: تستی بنویسم که fail شود
![[pycon-code-1.png]]

---
### ساختن کلاس dummy
![[pycon-code-0.png]]

---
### اجرای تست‌ها با pytest
![[pytest-1.png]]

---

### نوشتن کد اصلی تا pass شدن تست
![[pycon-code-2.png]]

![[pytest-2.png]]

---

### refactor کردن کد
- حالا که تست هارو داریم میتونیم توی کدمون با خیال راحت تغییر بدیم، مثلا نام تابع رو به get_parameters_count عوض کنیم.
- دوباره تست هامون رو اجرا می‌کنیم تا مطمئن بشیم این تغییر خطایی ایجاد نمیکند

![[pytest-2.png]]

---

### دوباره از ابتدا: نوشتن تست
![[pycon-code-3.png]]

---

تست دیگه‌ای که از این دو به ذهن ما می‌رسد تست کردن مقدار None است
![[pycon-code-4.png]]

---

### نوشتن کد تا پاس شدن تست
![[pycon-code-5.png]]

---

### تست جدید: گرفتن مقادیر Query
- تابع بعدی که نیاز داریم برای گرفتن value به ازای یک name هست
![[pycon-code-6.png]]
![[pycon-code-7.png]]

---

### نوشتن تست‌های بیشتر
در اینجا از قابلیت parametrize استفاده کردیم که چند ورودی مختلف در یک سناریوی تست را تست کنیم
![[pycon-code-8.png]]

---

توی این مرحله دنبال نوشتن بهترین کد ممکن نیستیم و با کد زیر تست پاس می‌شود.
![[pycon-code-9.png]]

---
### تست get_count برای چند مقدار
- با نوشتن تست دیگه تابع get_parameters_count رو کامل‌تر میکنیم
![[pycon-code-10.png]]
---
بهبود تابع count
![[pycon-code-11.png]]

---

### دوباره ریفکتور
![[pycon-code-12.png]]

---

### ران کردن تست‌ها
![[final-run.png]]


---

## نکات پایانی
### سرعت تست
- سرعت اجرا شدن تست‌ها از ملاک مهمی است
- در یونیت تست‌ها تست را طوری بنویسیم که کامل در مموری اجرا شود تا سریع باشد
- تست‌های کند اجرا نخواهند شد

---

### چه چیزهایی را تست کنیم؟
- هرچیزی که ممکن است خراب شود
- جزئیات پیاده‌سازی را تست نکنیم

---

## برای مطالعه‌ی بیشتر
- _[Test-Driven Development: By Example](https://amazon.com/gp/product/0321146530/)_
- [The Pragmatic Programmer](https://www.amazon.com/exec/obidos/ASIN/020161622X/codihorr-20)
